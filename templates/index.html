<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë ì•„ì˜ íŒ”ë ˆíŠ¸</title>

<style>
body{
  background:#111;
  color:white;
  font-family:sans-serif;
  text-align:center;
  margin:0;
}
header{
  background:#1a1a1a;
  padding:16px;
}
.logo{
  font-size:20px;
  margin-bottom:8px;
}
nav a{
  color:#ccc;
  margin:0 8px;
  text-decoration:none;
}
nav a:hover{ color:white; }

main{ padding:24px; }

.main-text{ font-size:20px; margin-bottom:8px; }
.sub-text{ color:#aaa; margin-bottom:16px; }

input{
  padding:10px;
  width:260px;
}
button{
  padding:10px;
  margin-left:6px;
}

.result-card{
  border:1px solid #444;
  margin:12px auto;
  padding:12px;
  border-radius:10px;
  max-width:360px;
}
.center{ text-align:center; }
.warning{ color:orange; }

.loading{ display:none; margin-top:16px; }

footer{
  margin-top:40px;
  padding:16px;
  color:#777;
  font-size:12px;
  border-top:1px solid #222;
}
</style>
</head>

<body>

<header>
    <div class="logo">ğŸ¨ ë ì•„ì˜ íŒ”ë ˆíŠ¸</div>
    <nav>
        <a href="/">íŒ€ì› ì´ˆìƒí™”</a>
        <a href="/self">ìí™”ìƒ</a>
        <a href="/scoreboard">ì±„ì í‘œ</a>
        <a href="https://naver.me/xNp300IW" target="_blank">ë¬¸ì˜í•˜ê¸°</a>
    </nav>
</header>

<main>

<div class="main-text">
íŒ€ì› ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ë©´,, í”Œë ˆì´ ì„±í–¥ì— ë§ëŠ” ì´ˆìƒí™”ë¥¼ ê·¸ë ¤ì¤˜,,!!
</div>

<div class="sub-text">
( ìŠ¤í˜ì´ìŠ¤ë°” , / ë¡œ êµ¬ë¶„í•˜ë©´ ìë™ìœ¼ë¡œ ë”°ë¡œ ê²€ìƒ‰í•´ì¤˜,,!! )
</div>

<input type="text" id="nickInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥">
<button onclick="analyze()">ì´ˆìƒí™” ì™„ì„±í•˜ê¸°</button>

<div class="loading" id="loading">
<p>ë¡œë”©ì¤‘ì´ì•¼,,!!</p>
<img src="/assets/tia-run.gif" width="100">
</div>

<div id="results"></div>

</main>

<footer>
ë³¸ ì‚¬ì´íŠ¸ëŠ” ë‹˜ë¸”ë‰´ëŸ° ê³µì‹ Open APIë¥¼ í™œìš©í•˜ë©°,
ë‹˜ë¸”ë‰´ëŸ° API ì´ìš© ê·œì •ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤.
</footer>

<script>
const input = document.getElementById("nickInput");
input.addEventListener("keydown", e=>{
  if(e.key==="Enter") analyze();
});

function splitNicknames(text){
  return text.split(/[ ,/]+/).filter(v=>v.trim()!=="");
}

async function analyze(){
  const raw = input.value.trim();
  if(!raw) return;

  const names = splitNicknames(raw);
  const resultArea = document.getElementById("results");
  const loading = document.getElementById("loading");

  resultArea.innerHTML="";
  loading.style.display="block";

  for(const nick of names){
    try{
      const res = await fetch("/analyze",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({nickname:nick})
      });

      const r = await res.json();

      if(!r || r.status){
        resultArea.innerHTML += `
          <div class="result-card center">
            ${nick}<br>${r?.status || "ê²€ìƒ‰ ì‹¤íŒ¨"}
          </div>`;
        continue;
      }

      // ìƒ‰ìƒ ì´í‰
      let comment="ì–´ë ¤ìš´ ê²Œì„ì´ ë  ê²ƒ ê°™ì•„,,,!!";
      if(r.color==="purple") comment="ì¢‹ì€ íŒ€ì›ì´ì•¼,,,!!";
      else if(r.color==="green") comment="ë¬´ë‚œí•œ ê²ƒ ê°™ì•„,,,!!";

      // ê¸°ë³¸ ì¹´ë“œ
      resultArea.innerHTML += `
        <div class="result-card center">
          ë‹‰ë„¤ì„: ${r.nickname}<br>
          ì ìˆ˜: ${r.score}<br>
          ìµœê·¼ ê²½ê¸°: ${r.recentGames}íŒ<br>
          ì „ì²´ ê²½ê¸°: ${r.totalGames}íŒ
        </div>`;

      // 50íŒ ë¬¸êµ¬ ìœ ì§€ (ì°¨ë‹¨ ì•„ë‹˜)
      if(r.totalGames < 50){
        resultArea.innerHTML += `
          <div class="result-card center">
            í‘œë³¸ ë¶€ì¡± (50íŒ ë¯¸ë§Œ)
          </div>`;
      }

      // ì´í‰
      resultArea.innerHTML += `
        <div class="result-card center">
          ${comment}
        </div>`;

      // ê²½ê³  ë³‘í–‰
      if(r.warning){
        resultArea.innerHTML += `
          <div class="result-card warning">
            ${r.warning}
          </div>`;
      }

    }catch(e){
      resultArea.innerHTML += `
        <div class="result-card center">
          ${nick}<br>ê²€ìƒ‰ ì‹¤íŒ¨
        </div>`;
    }
  }

  loading.style.display="none";
}
</script>

</body>
</html>
