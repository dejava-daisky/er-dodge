<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë ì•„ì˜ íŒ”ë ˆíŠ¸</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#0f0f0f;
    color:white;
    display:flex;
    flex-direction:column;
    min-height:100vh;
}

header{
    background:#181818;
    padding:20px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.logo{
    font-size:22px;
    font-weight:bold;
    color:#b48cff;
}

nav a{
    color:#ccc;
    text-decoration:none;
    margin-left:20px;
}

nav a:hover{ color:white; }

main{
    flex:1;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:40px 20px;
    text-align:center;
}

.main-text{
    font-size:20px;
    margin-bottom:10px;
}

.sub-text{
    font-size:13px;
    color:#888;
    margin-bottom:25px;
}

input{
    width:300px;
    padding:12px;
    border-radius:8px;
    border:none;
    margin-bottom:15px;
}

button{
    padding:12px 20px;
    border-radius:8px;
    border:none;
    background:#6c5ce7;
    color:white;
    cursor:pointer;
}

button:hover{ background:#5a4bd6; }

.loading{
    display:none;
    margin-top:20px;
}

.result-card{
    background:#1a1a1a;
    padding:20px;
    border-radius:15px;
    margin-top:30px;
    width:90%;
    max-width:600px;
    text-align:left;
}

.center{text-align:center;}

.squirrel-title{
    margin-top:8px;
    font-weight:bold;
}

.purple{ color:#b48cff; }
.green{ color:#6ee7b7; }
.orange{ color:#ff9f43; }

.summary{
    margin-top:15px;
    font-weight:bold;
    text-align:center;
}

footer{
    background:#111;
    padding:20px;
    text-align:center;
    font-size:12px;
    color:#777;
}
</style>
</head>

<body>

<header>
    <div class="logo">ğŸ¨ ë ì•„ì˜ íŒ”ë ˆíŠ¸</div>
    <nav>
        <a href="/">íŒ€ì› ì´ˆìƒí™”</a>
        <a href="/self">ìí™”ìƒ</a>
        <a href="/scoreboard">ì±„ì í‘œ</a>
        <a href="https://naver.me/xNp300IW" target="_blank">ë¬¸ì˜í•˜ê¸°</a>
    </nav>
</header>

<main>

<div class="main-text">
íŒ€ì› ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ë©´,, í”Œë ˆì´ ì„±í–¥ì— ë§ëŠ” ì´ˆìƒí™”ë¥¼ ê·¸ë ¤ì¤˜,,!!
</div>

<div class="sub-text">
( ìŠ¤í˜ì´ìŠ¤ë°” , / ë¡œ êµ¬ë¶„í•˜ë©´ ìë™ìœ¼ë¡œ ë”°ë¡œ ê²€ìƒ‰í•´ì¤˜,,!! )
</div>

<input type="text" id="nickInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥">
<button onclick="analyze()">ì´ˆìƒí™” ì™„ì„±í•˜ê¸°</button>

<div class="loading" id="loading">
<p>ë¡œë”©ì¤‘ì´ì•¼,,!!</p>
<img src="/assets/tia-run.gif" width="100">
</div>

<div id="results"></div>

</main>

<footer>
ë³¸ ì‚¬ì´íŠ¸ëŠ” ë‹˜ë¸”ë‰´ëŸ° ê³µì‹ Open APIë¥¼ í™œìš©í•˜ë©°,
ë‹˜ë¸”ë‰´ëŸ° API ì´ìš© ê·œì •ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤.
</footer>

<script>

function parseNicknames(input){
    return input.trim().split(/[ ,\/]+/).filter(n=>n.length>0).slice(0,2);
}

async function analyze(){

    if(document.getElementById("loading").style.display==="block") return;

    const raw=document.getElementById("nickInput").value;
    const nicks=parseNicknames(raw);
    if(nicks.length===0) return;

    document.getElementById("loading").style.display="block";
    document.getElementById("results").innerHTML="";

    const res=await fetch("/analyze",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({nicknames:nicks})
    });

    const data=await res.json();
    document.getElementById("loading").style.display="none";

    nicks.forEach(nick=>{
        const r=data[nick];

        if(!r || r.status==="sample"){
            document.getElementById("results").innerHTML+=`
                <div class="result-card center">
                    ${nick}<br>í‘œë³¸ ë¶€ì¡± (50íŒ ë¯¸ë§Œ)
                </div>`;
            return;
        }

        let colorClass="green";
        let stateText="ê¸°ë³µí˜• íŒ€ì›";
        let summary="ë¬´ë‚œí•œê²ƒ ê°™ì•„,,,!!";
        let imgName="squirrel_green.png";

        if(r.squirrel==="purple"){
            colorClass="purple";
            stateText="ì•ˆì •í˜• íŒ€ì›";
            summary="ì¢‹ì€íŒ€ì›ì´ì•¼,,,!!";
            imgName="squirrel_purple.png";
        }
        if(r.squirrel==="orange"){
            colorClass="orange";
            stateText="ìœ„í—˜ ì‹ í˜¸";
            summary="ì–´ë ¤ìš´ ê²Œì„ì´ ë ê²ƒê°™ì•„,,,!!";
            imgName="squirrel_orange.png";
        }

        let card=`
        <div class="result-card">
            <div class="center">
                <img src="/assets/${imgName}" width="100">
                <div class="squirrel-title ${colorClass}">${stateText}</div>
                <div style="margin-top:5px;">${r.nickname}</div>
            </div>
        `;

        if(r.squirrel!=="purple"){
            card+=`<h4>ë‹¨ì </h4>`;
            r.major_risks.forEach(x=> card+=`â€¢ ${x}<br>`);
            r.minor_risks.forEach(x=> card+=`â€¢ ${x}<br>`);
        }

        if(r.squirrel!=="orange"){
            card+=`<h4>ì¥ì </h4>`;
            r.strengths.forEach(x=> card+=`â€¢ ${x}<br>`);
        }

        card+=`<div class="summary ${colorClass}">${summary}</div></div>`;

        document.getElementById("results").innerHTML+=card;

        if (data.warning) {
          resultArea.innerHTML += "<p style='color:orange'>" + data.warning + "</p>";
        }
    });
}

/* ì—”í„° ê²€ìƒ‰ */
document.getElementById("nickInput")
.addEventListener("keydown", function(e){
    if(e.key==="Enter"){
        e.preventDefault();
        analyze();
    }
});

</script>

</body>
</html>

